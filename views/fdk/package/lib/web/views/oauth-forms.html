<html>
  <head>
    <title>OAuth Parameters</title>
    <link rel="icon" href="/web/assets/favicon.png" type="image/x-icon" sizes="16x16 32x32">
    <link rel="stylesheet" href="/web/assets/css/oauth-page.css">
    <link rel="stylesheet" href="http://dl.freshdev.io/sdk-packages/bootstrap/bootstrap.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src="http://dl.freshdev.io/sdk-packages/bootstrap/bootstrap.min.js"></script>
  </head>
  <body>
    <div class="box">
      <div class="logo-div">
        <div class="logo-block">
            <img src="/web/assets/freshworks_logo.svg" class="logo" align="middle">
            <span class="dev-text">{ developers }</span>
        </div>
      </div>
      <div class="box-row">
        <div class="box-title">
          <span id="info-banner">
            OAuth Parameters
          </span>
        </div>
      </div>
      <div class="oauth-form" >
        <form id="oauth_form"></form>
      </div>
    </div>
    <!-- <script src="/web/assets/js/event-page.js"></script> -->
    <script>
      jQuery.get("http://localhost:10001/oauth_iparams", function(data) {
        if (data) {
          Object.keys(data).forEach(function(key) {
            var oauthIParamItem = data[key];
            jQuery("#oauth_form").append(`
              <div class="form-group">
                <label class="input-label">${oauthIParamItem['display_name']}</label>
                <input type="text" class="form-control input-sm" id="conf_${key}" ${oauthIParamItem['required'] == true ? 'required' : ''}>
                <div style="padding-top: 5px">
                  <small class="form-text text-muted">${oauthIParamItem['description']}</small>
                </div>
              </div>
            `);
          });
          jQuery("#oauth_form").append(`<button type="submit" class="btn btn-primary btn-sm" id="oauth_redirect_btn">Submit</button>`);
          jQuery("#oauth_redirect_btn").click(function(e) {
            var oauthIParamValues = {};
            Object.keys(data).forEach(function(key) {
              oauthIParamValues[key] = jQuery(`#conf_${key}`).val();
            });
            if (jQuery("#oauth_form")[0].checkValidity() == true) {
              window.location = `http://localhost:10001/auth/index?oauth_iparams=${encodeURIComponent(JSON.stringify(oauthIParamValues))}&oauth_bypass=true`;
              e.preventDefault();
            }
          });
        }
      });
    </script>
  </body>
</html>
